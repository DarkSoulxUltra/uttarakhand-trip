<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uttarakhand Trip Planner</title>

<style>
body{margin:0;font-family:system-ui;background:#020617;color:#67e8f9}
h1{text-align:center;margin:12px 0}
.container{max-width:1200px;margin:auto;padding:12px;padding-bottom:300px}
.stickyTop{position:sticky;top:0;background:#020617;z-index:5}

.routeBox{border:1px solid #164e63;border-radius:14px;padding:10px;margin-bottom:10px}
.progressText{text-align:center;color:#22d3ee;font-weight:600}

.routeLine{position:relative;display:flex;justify-content:space-between;align-items:center;height:40px}
.routeLine::before{content:'';position:absolute;left:0;right:0;top:50%;height:3px;background:#164e63}
.node{width:18px;height:18px;background:#164e63;border-radius:50%;cursor:pointer}
.node.active{background:#22d3ee;box-shadow:0 0 10px #22d3ee}
.vehicle{position:absolute;top:-26px;transition:.35s}

.layout{display:flex;flex-wrap:wrap;gap:12px}
.timeline{flex:1;min-width:220px}
.content{flex:3;min-width:280px}

.card{border:1px solid #164e63;border-radius:12px;padding:10px;margin-bottom:8px;cursor:pointer}
.card.active{border-color:#22d3ee;box-shadow:0 0 12px rgba(34,211,238,.5)}

details{border:1px solid #164e63;border-radius:10px;padding:8px;margin:8px 0}
summary{cursor:pointer;font-weight:600}

button{background:#22d3ee;border:none;border-radius:6px;padding:6px 10px;font-weight:600;cursor:pointer}
button[disabled]{opacity:.4;cursor:not-allowed}

input,textarea,select{padding:6px;border-radius:6px;border:none;margin:4px;width:100%}

iframe{width:100%;height:220px;border-radius:10px;border:1px solid #164e63}

.badge{font-size:12px;color:#22d3ee}

.mobileNav{
 position:fixed;bottom:0;left:0;right:0;
 background:#020617;border-top:1px solid #164e63;
 display:flex;justify-content:space-around;padding:10px;z-index:10
}
</style>
</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<!-- TRIP CREATION -->
<details open>
<summary>â• Open / Create Trip</summary>
<input id="tripInput" placeholder="e.g. uttarakhand-mar-2026">
<button onclick="openTrip()">Open Trip</button>
</details>

<!-- PARTICIPANTS -->
<details open>
<summary>ğŸ‘¥ Participants <span id="viewBadge" class="badge"></span></summary>
<input id="newMember" placeholder="Name">
<button onclick="addMember()">Add</button>
<ul id="memberList"></ul>
</details>

<!-- ROUTE -->
<div class="stickyTop">
<div class="routeBox">
<div class="progressText" id="progressText"></div>
<div class="routeLine">
<div id="vehicle" class="vehicle">ğŸšŒ</div>
<div class="node" onclick="select(0)"></div>
<div class="node" onclick="select(1)"></div>
<div class="node" onclick="select(2)"></div>
<div class="node" onclick="select(3)"></div>
<div class="node" onclick="select(4)"></div>
<div class="node" onclick="select(5)"></div>
</div>
</div>
</div>

<div class="layout">
<div class="timeline" id="timeline"></div>
<div class="content" id="content"></div>
</div>
</div>

<div class="mobileNav">
<button onclick="prev()">â® Prev</button>
<button onclick="next()">Next â­</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBqiBMggvuMxAiKfBpJIqnv8OCWj76voAk",
  authDomain: "trip-planner-2026.firebaseapp.com",
  projectId: "trip-planner-2026",
  storageBucket: "trip-planner-2026.firebasestorage.app",
  messagingSenderId: "118349993233",
  appId: "1:118349993233:web:7edb1de869796188a428b0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* URL PARAMS */
const params = new URLSearchParams(location.search);
const tripId = params.get("trip") || "uttarakhand-mar-2026";
const viewOnly = params.get("view") === "readonly";
document.getElementById("viewBadge").innerText = viewOnly ? "(View only)" : "";

const tripRef = doc(db, "trips", tripId);

/* DATA */
const tripDates=["Sun","Mon","Tue","Wed","Thu","Fri"];

const days = [
{
  city: "Delhi â†’ Haridwar",
  title: "Arrival & Ganga Aarti",
  steps: [
    "Arrive Delhi (H. Nizamuddin)",
    "Bus to Haridwar",
    "Hotel check-in",
    "Evening Ganga Aarti at Har Ki Pauri",
    "Local market & dinner"
  ],
  highlights: [
    "Har Ki Pauri",
    "Ganga Aarti",
    "Local chaat market"
  ],
  map: "https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d55379.7",
  hotel: {
    name: "Hotel Ganga Lahari / similar (Har Ki Pauri area)",
    map: "https://maps.google.com/?q=Hotel+Ganga+Lahari+Haridwar"
  }
},
{
  city: "Haridwar â†’ Rishikesh",
  title: "Snaan & Ropeways",
  steps: [
    "Early morning Ganga Snaan",
    "Mansa Devi Ropeway",
    "Chandi Devi Ropeway",
    "Lunch",
    "Cab to Rishikesh",
    "Evening local market walk"
  ],
  highlights: [
    "Mansa Devi",
    "Chandi Devi"
  ],
  map: "https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d34260",
  hotel: {
    name: "Tapovan Sarovar / similar (Tapovan)",
    map: "https://maps.google.com/?q=Tapovan+Rishikesh+Hotel"
  }
},
{
  city: "Rishikesh",
  title: "Tapovan & CafÃ©s",
  steps: [
    "Ram Jhula",
    "Laxman Jhula",
    "Saptarishi Ashram",
    "CafÃ© hopping in Tapovan",
    "Sunset at riverbank"
  ],
  highlights: [
    "Ram Jhula",
    "Laxman Jhula",
    "Saptarishi Ashram"
  ],
  map: "https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d34261",
  hotel: {
    name: "Tapovan Stay (same hotel)",
    map: "https://maps.google.com/?q=Tapovan+Rishikesh"
  }
},
{
  city: "Rishikesh",
  title: "Rafting & Recovery",
  steps: [
    "Morning river rafting",
    "Return to hotel & freshen up",
    "Triveni Ghat",
    "Ganga Aarti",
    "Dinner by riverside cafÃ©"
  ],
  highlights: [
    "River Rafting",
    "Triveni Ghat"
  ],
  map: "https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d34262",
  hotel: {
    name: "Tapovan Stay (same hotel)",
    map: "https://maps.google.com/?q=Tapovan+Rishikesh"
  }
},
{
  city: "Rishikesh â†’ Dehradun",
  title: "Ashrams & Waterfall",
  steps: [
    "Checkout from Rishikesh",
    "Neer Garh Waterfall",
    "Cab to Dehradun",
    "Drona Ashram",
    "Deer Park",
    "Evening market walk"
  ],
  highlights: [
    "Neer Garh Waterfall",
    "Drona Ashram",
    "Deer Park"
  ],
  map: "https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d34263",
  hotel: {
    name: "Hotel near Rajpur Road / Ballupur",
    map: "https://maps.google.com/?q=Rajpur+Road+Dehradun+Hotel"
  }
},
{
  city: "Mussoorie â†’ Delhi",
  title: "Hill Wrap-up",
  steps: [
    "Early drive to Mussoorie",
    "Sahastradhara Waterfall",
    "Mall Road walk",
    "Return to Dehradun",
    "Overnight bus / flight to Delhi"
  ],
  highlights: [
    "Sahastradhara",
    "Mussoorie Mall Road"
  ],
  map: "https://www.google.com/maps/embed?pb=!1m28!1m12!1m3!1d34264",
  hotel: {
    name: "Day trip â€“ no stay",
    map: "https://maps.google.com/?q=Mussoorie+Mall+Road"
  }
}
];


let participants=["Sahil","Patil"];
let expenses={};
let notes={};
let active=0;

/* INIT / SYNC */
onSnapshot(tripRef,(snap)=>{
 if(!snap.exists() || !snap.data().participants){
  saveTrip(true);
  return;
 }
 const d=snap.data();
 participants=d.participants;
 expenses=d.expenses||{};
 notes=d.notes||{};
 render();
});

/* SAVE */
function saveTrip(seed=false){
 setDoc(tripRef,{
  participants,
  expenses,
  notes,
  updatedAt:Date.now()
 },{merge:!seed});
}

/* UI */
const timeline=document.getElementById("timeline");
const content=document.getElementById("content");

function buildTimeline(){
 timeline.innerHTML="";
 days.forEach((d,i)=>{
  const c=document.createElement("div");
  c.className="card"+(i===active?" active":"");
  c.innerHTML=`<b>${tripDates[i]}</b><br>${d.city}`;
  c.onclick=()=>select(i);
  timeline.appendChild(c);
 });
}

function render(){
 buildTimeline();
 renderMembers();
 document.getElementById("progressText").innerText=`${tripDates[active]} â€” ${days[active].city}`;
 document.querySelectorAll(".node").forEach((n,i)=>n.classList.toggle("active",i<=active));
 document.getElementById("vehicle").style.left=`calc(${active*(100/(days.length-1))}% - 12px)`;

 const d=days[active];
 const dayExp=expenses[active]||[];

 content.innerHTML=`
 <h2>${d.title}</h2>

 <details open>
 <summary>ğŸ§­ Step-by-step</summary>
 <ul>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ul>
 </details>

 <details open>
 <summary>ğŸ¨ Hotel</summary>
 <a href="${d.hotel.map}" target="_blank">${d.hotel.name}</a>
 </details>

 <details>
 <summary>ğŸ“ Highlights</summary>
 <ul>${d.highlights.map(h=>`<li>${h}</li>`).join("")}</ul>
 </details>

 <details>
 <summary>ğŸ—º Route Map</summary>
 <iframe src="${d.map}" loading="lazy"></iframe>
 </details>

 <details>
 <summary>ğŸ—º Hotel Location</summary>
 <iframe src="${d.hotel.map}&output=embed" loading="lazy"></iframe>
 </details>

 <details open>
 <summary>ğŸ“ Notes</summary>
 <textarea ${viewOnly?"disabled":""} oninput="saveNote(this.value)">${notes[active]||""}</textarea>
 </details>

 <details open>
 <summary>ğŸ’³ Add Expense</summary>
 <input id="et" placeholder="Title" ${viewOnly?"disabled":""}>
 <input id="ea" type="number" placeholder="Amount" ${viewOnly?"disabled":""}>
 <select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
 <button onclick="addExpense()" ${viewOnly?"disabled":""}>Add</button>
 </details>

 <details open>
 <summary>ğŸ§¾ Expenses</summary>
 ${dayExp.map((e,i)=>`${e.title} â‚¹${e.amount} (${e.paidBy}) ${viewOnly?"":"<button onclick='del("+i+")'>âŒ</button>"}`).join("")||"No expenses"}
 </details>
 `;
}

/* ACTIONS */
window.addExpense=()=>{
 if(viewOnly)return;
 const t=et.value,a=+ea.value,p=ep.value;
 if(!t||!a)return;
 expenses[active]=expenses[active]||[];
 expenses[active].push({title:t,amount:a,paidBy:p});
 saveTrip();
};

window.del=(i)=>{
 if(viewOnly)return;
 expenses[active].splice(i,1);
 saveTrip();
};

window.saveNote=(v)=>{
 if(viewOnly)return;
 notes[active]=v;
 saveTrip();
};

window.addMember=()=>{
 if(viewOnly)return;
 const v=newMember.value.trim();
 if(!v)return;
 participants.push(v);
 newMember.value="";
 saveTrip();
};

window.removeMember=(i)=>{
 if(viewOnly)return;
 participants.splice(i,1);
 saveTrip();
};

function renderMembers(){
 const ul=document.getElementById("memberList");
 ul.innerHTML="";
 participants.forEach((p,i)=>{
  ul.innerHTML+=`<li>${p} ${viewOnly?"":"<button onclick='removeMember("+i+")'>âŒ</button>"}</li>`;
 });
}

/* NAV */
window.select=(i)=>{active=i;render();}
window.next=()=>{active=(active+1)%days.length;render();}
window.prev=()=>{active=(active-1+days.length)%days.length;render();}

/* TRIP OPEN */
window.openTrip=()=>{
 const t=document.getElementById("tripInput").value.trim();
 if(!t)return;
 location.href=`?trip=${t}`;
};
</script>
</body>
</html>
