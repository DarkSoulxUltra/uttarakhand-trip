<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Uttarakhand Trip Planner</title>

<style>
body{margin:0;font-family:system-ui;background:#020617;color:#67e8f9}
h1{text-align:center;color:#22d3ee}
.container{max-width:1400px;margin:auto;padding:12px}

.routeBox{border:1px solid #164e63;border-radius:14px;padding:14px;margin-bottom:14px;position:relative}
.routeTitle{text-align:center;font-weight:600;color:#22d3ee;margin-bottom:6px}
.routeActions{position:absolute;top:10px;right:12px;display:flex;gap:8px}
.routeActions button{padding:4px 8px;font-size:12px}

.routeLine{position:relative;display:flex;justify-content:space-between;align-items:center;height:36px}
.routeLine::before{content:"";position:absolute;left:0;right:0;top:50%;height:3px;background:#164e63}
.node{width:18px;height:18px;background:#164e63;border-radius:50%;cursor:pointer;position:relative}
.node.active{background:#22d3ee;box-shadow:0 0 8px #22d3ee}
.node:hover::after{
  content:attr(data-tip);
  position:absolute;top:-26px;left:50%;transform:translateX(-50%);
  background:#020617;border:1px solid #164e63;
  padding:2px 6px;font-size:11px;border-radius:4px;white-space:nowrap
}
.vehicle{position:absolute;top:-22px;transition:.4s}

.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
@media(max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:600px){.grid{grid-template-columns:1fr}}

.sectionCard{border:1px solid #164e63;border-radius:12px;overflow:hidden}
.sectionHeader{padding:10px;font-weight:600;cursor:pointer;border-bottom:1px solid #164e63}
.sectionBody{display:none;padding:10px}
.sectionCard.expanded .sectionBody{display:block}

input,textarea,select{width:100%;margin:4px 0;padding:6px;border-radius:6px;border:none}
button{background:#22d3ee;border:none;border-radius:6px;padding:6px 10px;cursor:pointer}
ul{padding-left:18px}
</style>
</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<div class="routeBox">
  <div class="routeTitle" id="routeTitle"></div>
  <div class="routeActions">
    <button onclick="expandAll()">Expand all</button>
    <button onclick="collapseAll()">Collapse all</button>
  </div>
  <div class="routeLine">
    <div id="vehicle" class="vehicle">üöå</div>
    <div class="node" onclick="selectDay(0)"></div>
    <div class="node" onclick="selectDay(1)"></div>
    <div class="node" onclick="selectDay(2)"></div>
    <div class="node" onclick="selectDay(3)"></div>
    <div class="node" onclick="selectDay(4)"></div>
    <div class="node" onclick="selectDay(5)"></div>
  </div>
</div>

<div class="grid" id="content"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDoc,
  collection, onSnapshot
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* üî• YOUR EXISTING CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBqiBMggvuMxAiKfBpJIqnv8OCWj76voAk",
  authDomain: "trip-planner-2026.firebaseapp.com",
  projectId: "trip-planner-2026",
  storageBucket: "trip-planner-2026.appspot.com",
  messagingSenderId: "118349993233",
  appId: "1:118349993233:web:7edb1de869796188a428b0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ---------- DATA ---------- */
const tripDates=["Sun","Mon","Tue","Wed","Thu","Fri"];
const days=[
  {city:"Delhi ‚Üí Haridwar",steps:["Arrive Delhi","Bus","Ganga Aarti"]},
  {city:"Haridwar ‚Üí Rishikesh",steps:["Snan","Travel"]},
  {city:"Rishikesh",steps:["Jhulas","Cafes"]},
  {city:"Rishikesh",steps:["Rafting","Rest"]},
  {city:"Rishikesh ‚Üí Dehradun",steps:["Neergarh","Drive"]},
  {city:"Mussoorie ‚Üí Delhi",steps:["Mall Road","Return"]}
];

/* ---------- STATE ---------- */
const tripId = new URLSearchParams(location.search).get("trip") || "default-trip";
const tripRef = doc(db, "trips", tripId);

let activeDay=0;
let cardsExpanded=false;
let participants=[];
let notes={};
let expenses={};

/* ---------- FIREBASE LOAD ---------- */
async function initTrip(){
  const snap = await getDoc(tripRef);
  if(!snap.exists()){
    await setDoc(tripRef,{participants:[],notes:{}});
  }
}

onSnapshot(tripRef,s=>{
  const d=s.data();
  participants=d.participants||[];
  notes=d.notes||{};
  render();
});

for(let i=0;i<6;i++){
  const dayRef = doc(db,"trips",tripId,"expenses","day-"+i);
  onSnapshot(dayRef,s=>{
    expenses[i]=s.exists()?s.data().items:[];
    render();
  });
}

/* ---------- UI ---------- */
window.selectDay=i=>{activeDay=i;render()}
window.expandAll=()=>{cardsExpanded=true;render()}
window.collapseAll=()=>{cardsExpanded=false;render()}

function toggle(el){el.parentElement.classList.toggle("expanded")}

function render(){
  const d=days[activeDay];
  document.getElementById("routeTitle").innerText=`${tripDates[activeDay]} ‚Äî ${d.city}`;

  document.querySelectorAll(".node").forEach((n,i)=>{
    n.classList.toggle("active",i===activeDay);
    n.dataset.tip=`${tripDates[i]} ‚Äî ${days[i].city}`;
  });

  document.getElementById("vehicle").style.left=
    `calc(${activeDay*(100/(days.length-1))}% - 10px)`;

  document.getElementById("content").innerHTML=`
    ${card("üß≠ Step-by-step",`<ul>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ul>`)}
    ${card("üìù Notes",`
      <textarea oninput="saveNote(this.value)">${notes[activeDay]||""}</textarea>`)}
    ${card("üí≥ Expenses",`
      <input id="et" placeholder="Title">
      <input id="ea" type="number" placeholder="Amount">
      <select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
      <button onclick="addExpense()">Add</button>
      ${(expenses[activeDay]||[]).map(e=>`<div>${e.title} ‚Çπ${e.amount} (${e.paidBy})</div>`).join("")}`)}
    ${card("üìä Settlement",`
      Total ‚Çπ${(expenses[activeDay]||[]).reduce((a,b)=>a+b.amount,0)}`)}
  `;
}

function card(title,body){
  return `<div class="sectionCard ${cardsExpanded?"expanded":""}">
    <div class="sectionHeader" onclick="toggle(this)">${title}</div>
    <div class="sectionBody">${body}</div>
  </div>`;
}

window.saveNote = async v=>{
  notes[activeDay]=v;
  await setDoc(tripRef,{notes},{merge:true});
};

window.addExpense = async ()=>{
  const t=et.value,a=+ea.value,p=ep.value;
  if(!t||!a)return;
  const list=[...(expenses[activeDay]||[]),{title:t,amount:a,paidBy:p}];
  await setDoc(doc(db,"trips",tripId,"expenses","day-"+activeDay),{items:list});
};

initTrip();
render();
</script>
</body>
</html>
