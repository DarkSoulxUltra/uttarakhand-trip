<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uttarakhand Trip Planner</title>

<style>
body{margin:0;font-family:system-ui;background:#020617;color:#67e8f9}
h1{text-align:center;margin:12px 0}
.container{max-width:1200px;margin:auto;padding:12px;padding-bottom:280px}
.stickyTop{position:sticky;top:0;background:#020617;z-index:5}

.routeBox{border:1px solid #164e63;border-radius:14px;padding:10px;margin-bottom:8px}
.progressText{text-align:center;color:#22d3ee;font-weight:600}

.routeLine{position:relative;display:flex;justify-content:space-between;align-items:center;height:40px}
.routeLine::before{content:'';position:absolute;left:0;right:0;top:50%;height:3px;background:#164e63}
.node{width:18px;height:18px;background:#164e63;border-radius:50%;cursor:pointer}
.node.active{background:#22d3ee;box-shadow:0 0 10px #22d3ee}
.vehicle{position:absolute;top:-26px;transition:.35s}

.layout{display:flex;flex-wrap:wrap;gap:12px}
.timeline{flex:1;min-width:220px}
.content{flex:3;min-width:280px}

.card{border:1px solid #164e63;border-radius:12px;padding:10px;margin-bottom:8px;cursor:pointer}
.card.active{border-color:#22d3ee;box-shadow:0 0 12px rgba(34,211,238,.5)}

details{border:1px solid #164e63;border-radius:10px;padding:8px;margin:8px 0}
summary{cursor:pointer;font-weight:600}

button{background:#22d3ee;border:none;border-radius:6px;padding:6px 10px;font-weight:600;cursor:pointer}
input,textarea,select{padding:6px;border-radius:6px;border:none;margin:4px;width:100%}

iframe{width:100%;height:220px;border-radius:10px;border:1px solid #164e63}

.mobileNav{
 position:fixed;bottom:0;left:0;right:0;
 background:#020617;border-top:1px solid #164e63;
 display:flex;justify-content:space-around;padding:10px;z-index:10
}
</style>
</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<details open>
<summary>üë• Participants</summary>
<input id="newMember" placeholder="Name">
<button onclick="addMember()">Add</button>
<ul id="memberList"></ul>
</details>

<div class="stickyTop">
<div class="routeBox">
<div class="progressText" id="progressText"></div>
<div class="routeLine">
<div id="vehicle" class="vehicle">üöå</div>
<div class="node" onclick="select(0)"></div>
<div class="node" onclick="select(1)"></div>
<div class="node" onclick="select(2)"></div>
<div class="node" onclick="select(3)"></div>
<div class="node" onclick="select(4)"></div>
<div class="node" onclick="select(5)"></div>
</div>
</div>
</div>

<div class="layout">
<div class="timeline" id="timeline"></div>
<div class="content" id="content"></div>
</div>
</div>

<div class="mobileNav">
<button onclick="prev()">‚èÆ Prev</button>
<button onclick="next()">Next ‚è≠</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBqiBMggvuMxAiKfBpJIqnv8OCWj76voAk",
  authDomain: "trip-planner-2026.firebaseapp.com",
  projectId: "trip-planner-2026",
  storageBucket: "trip-planner-2026.firebasestorage.app",
  messagingSenderId: "118349993233",
  appId: "1:118349993233:web:7edb1de869796188a428b0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* üîë TRIP ID */
const params = new URLSearchParams(window.location.search);
const tripId = params.get("trip") || "uttarakhand-mar-2026";
const tripRef = doc(db, "trips", tripId);

/* ---------- DATA ---------- */
const tripDates=["Sun","Mon","Tue","Wed","Thu","Fri"];
const days=[
 {city:"Delhi ‚Üí Haridwar",title:"Arrival & Ganga Aarti",steps:["Arrive Delhi","Bus to Haridwar","Ganga Aarti"]},
 {city:"Haridwar ‚Üí Rishikesh",title:"Ashrams & Ropeways",steps:["Deep Snaan","Mansa Devi","Saptarishi"]},
 {city:"Rishikesh",title:"Tapovan & Caf√©s",steps:["Ram Jhula","Tapovan caf√©s"]},
 {city:"Rishikesh",title:"Rafting Day",steps:["Rafting","Rest"]},
 {city:"Rishikesh ‚Üí Dehradun",title:"Waterfalls & Ashrams",steps:["Neergarh","Drona Ashram","Deer Park"]},
 {city:"Mussoorie ‚Üí Delhi",title:"Hill Wrap-up",steps:["Sahastradhara","Mall Road"]}
];

let participants=["Sahil","Patil"];
let expenses={};
let notes={};
let active=0;

/* üîÑ REALTIME SYNC */
onSnapshot(tripRef, (snap) => {
  if (!snap.exists()) {
    // document doesn't exist ‚Üí create it
    saveTrip(true);
    return;
  }

  const data = snap.data();

  // üîë FIRST-TIME SEED (this fixes your issue)
  if (!data.participants) {
    saveTrip(true);
    return;
  }

  participants = data.participants;
  expenses = data.expenses || {};
  notes = data.notes || {};
  render();
});


/* üíæ SAVE */
function saveTrip(isSeed = false) {
  setDoc(tripRef, {
    participants: participants.length ? participants : ["Sahil", "Patil"],
    expenses,
    notes,
    updatedAt: Date.now()
  }, { merge: !isSeed });
}


/* ---------- UI ---------- */
const timeline=document.getElementById("timeline");
const content=document.getElementById("content");

function buildTimeline(){
 timeline.innerHTML="";
 days.forEach((d,i)=>{
  const c=document.createElement("div");
  c.className="card"+(i===active?" active":"");
  c.innerHTML=`<b>${tripDates[i]}</b><br>${d.city}`;
  c.onclick=()=>select(i);
  timeline.appendChild(c);
 });
}

function render(){
 buildTimeline();
 renderMembers();
 document.getElementById("progressText").innerText=`${tripDates[active]} ‚Äî ${days[active].city}`;
 document.querySelectorAll(".node").forEach((n,i)=>n.classList.toggle("active",i<=active));
 document.getElementById("vehicle").style.left=`calc(${active*(100/(days.length-1))}% - 12px)`;

 const dayExp=expenses[active]||[];
 content.innerHTML=`
 <h2>${days[active].title}</h2>

 <details open>
 <summary>üß≠ Step-by-step</summary>
 <ul>${days[active].steps.map(s=>`<li>${s}</li>`).join("")}</ul>
 </details>

 <details open>
 <summary>üìù Notes</summary>
 <textarea oninput="saveNote(this.value)">${notes[active]||""}</textarea>
 </details>

 <details open>
 <summary>üí≥ Add Expense</summary>
 <input id="et" placeholder="Title">
 <input id="ea" type="number" placeholder="Amount">
 <select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
 <button onclick="addExpense()">Add</button>
 </details>

 <details open>
 <summary>üßæ Expenses</summary>
 ${dayExp.map((e,i)=>`${e.title} ‚Çπ${e.amount} (${e.paidBy}) <button onclick="del(${i})">‚ùå</button>`).join("")||"No expenses"}
 </details>
 `;
}

window.addExpense=()=>{
 const t=et.value,a=+ea.value,p=ep.value;
 if(!t||!a)return;
 expenses[active]=expenses[active]||[];
 expenses[active].push({title:t,amount:a,paidBy:p});
 saveTrip();
};

window.del=(i)=>{
 expenses[active].splice(i,1);
 saveTrip();
};

window.saveNote=(v)=>{
 notes[active]=v;
 saveTrip();
};

window.addMember=()=>{
 const v=newMember.value.trim();
 if(!v)return;
 participants.push(v);
 newMember.value="";
 saveTrip();
};

window.removeMember=(i)=>{
 participants.splice(i,1);
 saveTrip();
};

function renderMembers(){
 const ul=document.getElementById("memberList");
 ul.innerHTML="";
 participants.forEach((p,i)=>{
  ul.innerHTML+=`<li>${p} <button onclick="removeMember(${i})">‚ùå</button></li>`;
 });
}

window.select=(i)=>{active=i;render();}
window.next=()=>{active=(active+1)%days.length;render();}
window.prev=()=>{active=(active-1+days.length)%days.length;render();}
</script>
</body>
</html>
