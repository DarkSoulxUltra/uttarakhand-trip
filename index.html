<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uttarakhand Group Trip Planner</title>

<style>
body{margin:0;font-family:system-ui;background:#020617;color:#67e8f9}
h1{text-align:center;margin:10px 0}
.container{max-width:1200px;margin:auto;padding:12px;padding-bottom:300px}
.stickyTop{position:sticky;top:0;background:#020617;z-index:5}

/* ROUTE */
.routeBox{border:1px solid #164e63;border-radius:14px;padding:10px;margin-bottom:8px;position:relative}
.progressText{text-align:center;color:#22d3ee;font-weight:600}
.weatherTop{text-align:center;font-size:13px;margin:4px 0;color:#a5f3fc}

.routeLine{position:relative;display:flex;justify-content:space-between;align-items:center;height:42px}
.routeLine::before{content:'';position:absolute;left:0;right:0;top:50%;height:3px;background:#164e63}
.node{width:18px;height:18px;background:#164e63;border-radius:50%}
.node.active{background:#22d3ee;box-shadow:0 0 10px #22d3ee}
.vehicle{position:absolute;top:-26px;transition:.6s}

/* SVG route */
svg{position:absolute;left:0;right:0;top:0;width:100%;height:100%;pointer-events:none}
polyline{fill:none;stroke:#22d3ee;stroke-width:3;stroke-dasharray:200;stroke-dashoffset:200;transition:.8s}

/* LAYOUT */
.layout{display:flex;flex-wrap:wrap;gap:12px}
.timeline{flex:1;min-width:220px}
.content{flex:3;min-width:280px}

.card{border:1px solid #164e63;border-radius:12px;padding:10px;margin-bottom:8px;cursor:pointer}
.card.active{border-color:#22d3ee;box-shadow:0 0 12px rgba(34,211,238,.5)}

details{border:1px solid #164e63;border-radius:10px;padding:8px;margin:8px 0}
summary{cursor:pointer;font-weight:600}

button{background:#22d3ee;border:none;border-radius:6px;padding:6px 10px;font-weight:600;cursor:pointer}
input,select{padding:6px;border-radius:6px;border:none;margin:4px}

iframe{width:100%;height:220px;border-radius:10px;border:1px solid #164e63}

.mobileNav{
 position:fixed;bottom:0;left:0;right:0;
 background:#020617;border-top:1px solid #164e63;
 display:flex;justify-content:space-around;padding:10px;z-index:10;
}
</style>
</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<details open>
<summary>üßÆ Expense Split Mode</summary>
<select id="splitMode" onchange="render()">
<option value="person">Per Person</option>
<option value="couple">Per Couple</option>
</select>
</details>

<div class="stickyTop">
<div class="routeBox">
<div class="progressText" id="progressText"></div>
<div class="weatherTop" id="weatherTop"></div>

<svg viewBox="0 0 100 20">
<polyline id="routeLineSvg" points="0,10 20,10 40,10 60,10 80,10 100,10"/>
</svg>

<div class="routeLine">
<div id="vehicle" class="vehicle">üöå</div>
<div class="node"></div><div class="node"></div><div class="node"></div>
<div class="node"></div><div class="node"></div><div class="node"></div>
</div>
</div>
</div>

<div class="layout">
<div class="timeline" id="timeline"></div>
<div class="content" id="content"></div>
</div>
</div>

<div class="mobileNav">
<button onclick="prev()">‚èÆ Prev</button>
<button onclick="next()">Next ‚è≠</button>
</div>

<script>
/* ===== WEATHER (AUTO-REFRESH) ===== */
const cityCoords={
 Haridwar:{lat:29.9457,lon:78.1642},
 Rishikesh:{lat:30.0869,lon:78.2676},
 Dehradun:{lat:30.3165,lon:78.0322},
 Mussoorie:{lat:30.4598,lon:78.0644}
};
const dayCity=["Haridwar","Haridwar","Rishikesh","Rishikesh","Dehradun","Mussoorie"];
const tripStart=new Date("2026-03-15");

async function getWeather(day){
 const city=dayCity[day];
 const {lat,lon}=cityCoords[city];
 const d=new Date(tripStart);d.setDate(tripStart.getDate()+day);
 const ds=d.toISOString().split("T")[0];

 try{
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,precipitation_probability_max,windspeed_10m_max&start_date=${ds}&end_date=${ds}&timezone=auto`;
  const r=await fetch(url,{cache:"no-store"});
  const j=await r.json();
  return `üå§Ô∏è ${Math.round(j.daily.temperature_2m_max[0])}¬∞C | üå¨Ô∏è ${Math.round(j.daily.windspeed_10m_max[0])} km/h | üíß ${j.daily.precipitation_probability_max[0]}%`;
 }catch{
  return "Weather unavailable ‚Äì refresh later";
 }
}

/* ===== DATA ===== */
const tripDates=["Sun","Mon","Tue","Wed","Thu","Fri"];
const days=[
{city:"Delhi ‚Üí Haridwar",title:"Arrival & Ganga Aarti"},
{city:"Haridwar ‚Üí Rishikesh",title:"Snaan & Ropeways"},
{city:"Rishikesh",title:"Tapovan & Caf√©s"},
{city:"Rishikesh",title:"Rafting & Recovery"},
{city:"Rishikesh ‚Üí Dehradun",title:"Neergarh & Triveni"},
{city:"Mussoorie ‚Üí Delhi",title:"Hill Wrap-up"}
];

let participants=JSON.parse(localStorage.getItem("participants"))||["You","Spouse","Couple-2A","Couple-2B"];
let expenses=JSON.parse(localStorage.getItem("expenses"))||[];
const couples={"Couple 1":["You","Spouse"],"Couple 2":["Couple-2A","Couple-2B"]};

let active=0;
const timeline=document.getElementById("timeline");
const content=document.getElementById("content");

function calcSettlement(){
 const mode=document.getElementById("splitMode").value;
 let buckets={},total=0;

 if(mode==="person"){
  participants.forEach(p=>buckets[p]=0);
  expenses.forEach(e=>{buckets[e.paidBy]+=e.amount;total+=e.amount});
  return {buckets,total,share:total/participants.length};
 }

 Object.keys(couples).forEach(c=>buckets[c]=0);
 expenses.forEach(e=>{
  const c=Object.keys(couples).find(k=>couples[k].includes(e.paidBy));
  if(c)buckets[c]+=e.amount;
  total+=e.amount;
 });
 return {buckets,total,share:total/2};
}

function buildTimeline(){
 timeline.innerHTML="";
 days.forEach((d,i)=>{
  const c=document.createElement("div");
  c.className="card"+(i===active?" active":"");
  c.innerHTML=`<b>${tripDates[i]}</b><br>${d.city}`;
  c.onclick=()=>select(i);
  timeline.appendChild(c);
 });
}

async function render(){
 buildTimeline();
 document.getElementById("progressText").innerText=`${tripDates[active]} ‚Äî ${days[active].city}`;
 document.querySelectorAll(".node").forEach((n,i)=>n.classList.toggle("active",i<=active));
 document.getElementById("vehicle").style.left=`calc(${active*(100/(days.length-1))}% - 12px)`;
 document.getElementById("routeLineSvg").style.strokeDashoffset=200-(active*40);

 const w=await getWeather(active);
 document.getElementById("weatherTop").innerText=w;

 const {buckets,total,share}=calcSettlement();

 content.innerHTML=`
 <h2>${days[active].title}</h2>
 <p><b>Weather:</b> ${w}</p>

 <details open><summary>üí≥ Add Expense</summary>
 <input id="et" placeholder="Title">
 <input id="ea" type="number" placeholder="Amount">
 <select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
 <button onclick="addExpense()">Add</button>
 </details>

 <details open><summary>üßæ Expenses</summary>
 ${expenses.map((e,i)=>`<div>${e.title} ‚Çπ${e.amount} (${e.paidBy}) <button onclick="del(${i})">‚ùå</button></div>`).join("")||"No expenses"}
 </details>

 <details open><summary>üìä Settlement</summary>
 Total ‚Çπ${total} | Share ‚Çπ${Math.round(share)}
 <ul>${Object.keys(buckets).map(k=>{
  const d=buckets[k]-share;
  return `<li>${k} ${d>0?"gets":"pays"} ‚Çπ${Math.abs(Math.round(d))}</li>`;
 }).join("")}</ul>
 </details>`;
}

function addExpense(){
 const t=et.value,a=parseInt(ea.value),p=ep.value;
 if(!t||!a)return;
 expenses.push({title:t,amount:a,paidBy:p});
 localStorage.setItem("expenses",JSON.stringify(expenses));
 render();
}
function del(i){expenses.splice(i,1);localStorage.setItem("expenses",JSON.stringify(expenses));render();}
function select(i){active=i;render();}
function next(){active=(active+1)%days.length;render();}
function prev(){active=(active-1+days.length)%days.length;render();}

render();
</script>
</body>
</html>
