<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Uttarakhand Trip Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#020b1f;
  --border:#164e63;
  --accent:#22d3ee;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);
  color:#a5f3fc;
}
h1{text-align:center;color:var(--accent)}
.container{max-width:1400px;margin:auto;padding:16px}

/* ROUTE */
.route{
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:20px;
}
.route-title{text-align:center;color:var(--accent);margin-bottom:10px}
.route-line{
  display:flex;justify-content:space-between;align-items:center;
  position:relative;margin-top:10px
}
.route-line::before{
  content:"";position:absolute;left:0;right:0;top:50%;
  height:3px;background:var(--border)
}
.dot{
  width:16px;height:16px;border-radius:50%;
  background:#155e75;z-index:1;cursor:pointer
}
.dot.active{background:var(--accent);box-shadow:0 0 10px var(--accent)}
.bus{
  position:absolute;top:-28px;transition:.4s;font-size:18px
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  animation:cardEnter .25s ease both;
  transition:transform .2s, box-shadow .2s, border-color .2s;
}
.card:hover{
  transform:translateY(-4px);
  border-color:var(--accent);
  box-shadow:0 8px 24px rgba(34,211,238,.25);
}
.card h3{margin:0 0 8px 0;color:var(--accent)}
iframe{width:100%;height:220px;border:0;border-radius:10px}

input,select,textarea,button{
  width:100%;margin:6px 0;padding:8px;
  border-radius:6px;border:none
}
button{background:var(--accent);cursor:pointer}
.log{font-size:13px;border-bottom:1px solid #134e4a;padding:4px 0}

@keyframes cardEnter{
  from{opacity:0;transform:translateY(8px)}
  to{opacity:1;transform:none}
}
</style>
</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<div class="route">
  <div class="route-title" id="routeTitle"></div>
  <div class="route-line" id="routeLine">
    <div class="bus" id="bus">ğŸšŒ</div>
  </div>
</div>

<div class="grid" id="cards"></div>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBqiBMggvuMxAiKfBpJIqnv8OCWj76voAk",
  authDomain: "trip-planner-2026.firebaseapp.com",
  projectId: "trip-planner-2026"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= DATA ================= */
const tripId = new URLSearchParams(location.search).get("trip") || "default";
const tripDates = ["Sun","Mon","Tue","Wed","Thu","Fri"];

const days = [
  {
    city:"Delhi â†’ Haridwar",
    steps:["Arrive Delhi","Bus to Haridwar","Hotel check-in","Ganga Aarti"],
    routeMap:"https://www.google.com/maps?q=Delhi+to+Haridwar&output=embed",
    hotel:{
      name:"Hotel near Har Ki Pauri",
      link:"https://maps.google.com/?q=Har+Ki+Pauri+Haridwar",
      map:"https://www.google.com/maps?q=Har+Ki+Pauri+Haridwar&output=embed"
    },
    food:["Local chai","Chotiwala"],
    emergency:["Ambulance:108","Police:112"]
  },
  {
    city:"Haridwar â†’ Rishikesh",
    steps:["Morning Aarti","Travel","Explore ghats"],
    routeMap:"https://www.google.com/maps?q=Haridwar+to+Rishikesh&output=embed",
    hotel:{
      name:"Hotel in Tapovan",
      link:"https://maps.google.com/?q=Tapovan+Rishikesh",
      map:"https://www.google.com/maps?q=Tapovan+Rishikesh&output=embed"
    },
    food:["German Bakery","Cafe"],
    emergency:["Ambulance:108","Police:112"]
  },
  {city:"Rishikesh",steps:["Rafting","Cafes","Ashrams"],routeMap:"https://www.google.com/maps?q=Rishikesh&output=embed",hotel:{name:"Same Hotel",link:"#",map:"https://www.google.com/maps?q=Tapovan+Rishikesh&output=embed"},food:["Snacks"],emergency:["108"]},
  {city:"Rishikesh",steps:["Waterfall","Rest"],routeMap:"https://www.google.com/maps?q=Neer+Waterfall+Rishikesh&output=embed",hotel:{name:"Same Hotel",link:"#",map:"https://www.google.com/maps?q=Tapovan+Rishikesh&output=embed"},food:["Tea"],emergency:["108"]},
  {city:"Rishikesh â†’ Dehradun",steps:["Travel","Explore"],routeMap:"https://www.google.com/maps?q=Rishikesh+to+Dehradun&output=embed",hotel:{name:"Hotel in Dehradun",link:"#",map:"https://www.google.com/maps?q=Dehradun&output=embed"},food:["Street food"],emergency:["108"]},
  {city:"Mussoorie â†’ Delhi",steps:["Sightseeing","Return"],routeMap:"https://www.google.com/maps?q=Mussoorie&output=embed",hotel:{name:"Day Trip",link:"#",map:"https://www.google.com/maps?q=Mussoorie&output=embed"},food:["Cafe"],emergency:["108"]}
];

let activeDay = 0;
let expenses = [];
let logs = [];
let participants = [];
let notes = {};

/* ================= ROUTE DOTS ================= */
const routeLine = document.getElementById("routeLine");
days.forEach((_,i)=>{
  const d=document.createElement("div");
  d.className="dot";
  d.onclick=()=>{activeDay=i;render()};
  routeLine.appendChild(d);
});

/* ================= FIREBASE LISTENERS ================= */
function attachFirebaseListeners(){
  const tripRef = db.collection("trips").doc(tripId);

  tripRef.onSnapshot(doc=>{
    if(!doc.exists) return;
    participants = doc.data().participants || [];
    notes = doc.data().notes || {};
    render();
  });

  tripRef.collection("expenses").orderBy("createdAt","asc")
  .onSnapshot(s=>{
    expenses = s.docs.map(d=>({id:d.id,...d.data()}));
    render();
  });

  tripRef.collection("logs").orderBy("time","desc")
  .onSnapshot(s=>{
    logs = s.docs.map(d=>d.data());
    render();
  });
}

/* ================= SETTLEMENT ================= */
function calculateSettlement(){
  let total=0, paid={};
  participants.forEach(p=>paid[p]=0);
  expenses.forEach(e=>{
    total+=e.amount;
    paid[e.paidBy]=(paid[e.paidBy]||0)+e.amount;
  });
  const share=participants.length?total/participants.length:0;
  const settlement={};
  participants.forEach(p=>settlement[p]=Math.round(paid[p]-share));
  return {total,share,settlement};
}

/* ================= ACTIONS ================= */
function addExpense(){
  const t=document.getElementById("et").value.trim();
  const a=parseInt(document.getElementById("ea").value,10);
  const p=document.getElementById("ep").value;
  if(!t||!a||!p) return;

  db.collection("trips").doc(tripId).collection("expenses").add({
    title:t,amount:a,paidBy:p,createdAt:Date.now()
  });
  db.collection("trips").doc(tripId).collection("logs").add({
    text:`${p} added â‚¹${a} for ${t}`,time:Date.now()
  });
}

function delExpense(id){
  const e=expenses.find(x=>x.id===id);
  if(!e) return;
  db.collection("trips").doc(tripId).collection("expenses").doc(id).delete();
  db.collection("trips").doc(tripId).collection("logs").add({
    text:`${e.paidBy} removed â‚¹${e.amount} for ${e.title}`,time:Date.now()
  });
}

function addMember(){
  const name=document.getElementById("newMember").value.trim();
  if(!name) return;
  db.collection("trips").doc(tripId)
    .update({participants:firebase.firestore.FieldValue.arrayUnion(name)});
}

function removeMember(name){
  db.collection("trips").doc(tripId)
    .update({participants:firebase.firestore.FieldValue.arrayRemove(name)});
}

function saveNotes(){
  db.collection("trips").doc(tripId)
    .update({[`notes.${activeDay}`]:document.getElementById("notesBox").value});
}

/* ================= RENDER ================= */
function render(){
  document.getElementById("routeTitle").innerText=
    `${tripDates[activeDay]} â€” ${days[activeDay].city}`;
  document.querySelectorAll(".dot").forEach((d,i)=>d.classList.toggle("active",i===activeDay));
  document.getElementById("bus").style.left=`calc(${activeDay*(100/(days.length-1))}% - 8px)`;

  const d=days[activeDay];
  const {total,share,settlement}=calculateSettlement();

  document.getElementById("cards").innerHTML=`
<div class="card"><h3>ğŸ§­ Step-by-step</h3><ul>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ul></div>
<div class="card"><h3>ğŸ—º Route Map</h3><iframe src="${d.routeMap}"></iframe></div>
<div class="card"><h3>ğŸ¨ Hotel</h3><a href="${d.hotel.link}" target="_blank">${d.hotel.name}</a><iframe src="${d.hotel.map}"></iframe></div>
<div class="card"><h3>ğŸ“ Notes</h3><textarea id="notesBox">${notes[activeDay]||""}</textarea><button onclick="saveNotes()">Save Notes</button></div>
<div class="card"><h3>ğŸ‘¥ Members</h3><input id="newMember" placeholder="Name"><button onclick="addMember()">Add</button>${participants.map(p=>`<div>${p} <button onclick="removeMember('${p}')">âŒ</button></div>`).join("")}</div>
<div class="card"><h3>ğŸ’³ Expenses</h3>
<input id="et" placeholder="Title"><input id="ea" type="number" placeholder="Amount">
<select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
<button onclick="addExpense()">Add</button>
${expenses.map(e=>`<div>${e.title} â‚¹${e.amount} (${e.paidBy}) <button onclick="delExpense('${e.id}')">âŒ</button></div>`).join("")}
</div>
<div class="card"><h3>ğŸ“Š Settlement</h3>
<b>Total:</b> â‚¹${total}<br><b>Per Person:</b> â‚¹${Math.round(share)}<hr>
${Object.entries(settlement).map(([p,v])=>v>0?`ğŸŸ¢ ${p} gets â‚¹${v}`:v<0?`ğŸ”´ ${p} pays â‚¹${Math.abs(v)}`:`âšª ${p} settled`).join("<br>")}
</div>
<div class="card"><h3>ğŸ§¾ Logs</h3>${logs.map(l=>`<div class="log">${l.text}</div>`).join("")}</div>
`;
}

attachFirebaseListeners();
</script>
</body>
</html>
