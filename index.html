<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uttarakhand Trip Planner</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#020617;
  color:#67e8f9
}

h1{text-align:center;margin:12px 0}

.container{
  max-width:1400px;
  margin:auto;
  padding:12px;
  padding-bottom:280px
}

/* ===== ROUTE HEADER ===== */
.stickyTop{
  position:sticky;
  top:0;
  background:#020617;
  z-index:5
}

.routeBox{
  border:1px solid #164e63;
  border-radius:16px;
  padding:12px;
  margin-bottom:12px
}

.progressText{
  text-align:center;
  color:#22d3ee;
  font-weight:600;
  margin-bottom:8px
}

.routeLine{
  position:relative;
  display:flex;
  justify-content:space-between;
  align-items:center;
  height:36px
}

.routeLine::before{
  content:'';
  position:absolute;
  left:0;
  right:0;
  top:50%;
  height:3px;
  background:#164e63
}

.node{
  width:16px;
  height:16px;
  background:#164e63;
  border-radius:50%;
  cursor:pointer;
  z-index:1
}

.node.active{
  background:#22d3ee;
  box-shadow:0 0 10px #22d3ee
}

.vehicle{
  position:absolute;
  top:-24px;
  transition:.3s
}

/* ===== MAIN LAYOUT ===== */
.layout{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:14px
}

@media(max-width:900px){
  .layout{
    grid-template-columns:1fr
  }
}

/* ===== LEFT TIMELINE ===== */
.timeline{
  border:1px solid #164e63;
  border-radius:14px;
  padding:10px
}

.card{
  border:1px solid #164e63;
  border-radius:12px;
  padding:10px;
  margin-bottom:8px;
  cursor:pointer
}

.card.active{
  border-color:#22d3ee;
  box-shadow:0 0 12px rgba(34,211,238,.4)
}

/* ===== CONTENT GRID ===== */
.content{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:12px
}

/* ===== CONTENT CARDS ===== */
.sectionCard{
  border:1px solid #164e63;
  border-radius:14px;
  padding:12px;
  background:rgba(2,6,23,.6)
}

.sectionHeader{
  font-weight:700;
  color:#22d3ee;
  margin-bottom:8px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center
}

.sectionBody{
  margin-top:8px
}

/* ===== FORM ELEMENTS ===== */
input,textarea,select{
  width:100%;
  padding:6px;
  border-radius:6px;
  border:none;
  margin:4px 0
}

button{
  background:#22d3ee;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  font-weight:600;
  cursor:pointer
}

button[disabled]{
  opacity:.4;
  cursor:not-allowed
}

iframe{
  width:100%;
  height:220px;
  border-radius:10px;
  border:1px solid #164e63
}

/* ===== MOBILE NAV ===== */
.mobileNav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#020617;
  border-top:1px solid #164e63;
  display:flex;
  justify-content:space-around;
  padding:10px;
  z-index:10
}
</style>

</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<!-- TRIP CREATION -->
<details open>
<summary>‚ûï Open / Create Trip</summary>
<input id="tripInput" placeholder="e.g. uttarakhand-mar-2026">
<button onclick="openTrip()">Open Trip</button>
</details>

<!-- PARTICIPANTS -->
<details open>
<summary>üë• Participants <span id="viewBadge" class="badge"></span></summary>
<input id="newMember" placeholder="Name">
<button onclick="addMember()">Add</button>
<ul id="memberList"></ul>
</details>

<!-- ROUTE -->
<div class="stickyTop">
<div class="routeBox">
<div class="progressText" id="progressText"></div>
<div class="routeLine">
<div id="vehicle" class="vehicle">üöå</div>
<div class="node" onclick="select(0)"></div>
<div class="node" onclick="select(1)"></div>
<div class="node" onclick="select(2)"></div>
<div class="node" onclick="select(3)"></div>
<div class="node" onclick="select(4)"></div>
<div class="node" onclick="select(5)"></div>
</div>
</div>
</div>

<div class="layout">
<div class="timeline" id="timeline"></div>
<div class="content" id="content"></div>
</div>
</div>

<div class="mobileNav">
<button onclick="prev()">‚èÆ Prev</button>
<button onclick="next()">Next ‚è≠</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyBqiBMggvuMxAiKfBpJIqnv8OCWj76voAk",
  authDomain: "trip-planner-2026.firebaseapp.com",
  projectId: "trip-planner-2026",
  storageBucket: "trip-planner-2026.firebasestorage.app",
  messagingSenderId: "118349993233",
  appId: "1:118349993233:web:7edb1de869796188a428b0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* URL PARAMS */
const params = new URLSearchParams(location.search);
const tripId = params.get("trip") || "uttarakhand-mar-2026";
const viewOnly = params.get("view") === "readonly";
document.getElementById("viewBadge").innerText = viewOnly ? "(View only)" : "";

const tripRef = doc(db, "trips", tripId);

/* DATA */
const tripDates=["Sun","Mon","Tue","Wed","Thu","Fri"];

const days = [
{
  city: "Delhi ‚Üí Haridwar",
  title: "Arrival & Ganga Aarti",
  steps: [
    "Arrive Delhi (H. Nizamuddin)",
    "Bus to Haridwar",
    "Hotel check-in",
    "Evening Ganga Aarti at Har Ki Pauri",
    "Local market & dinner"
  ],
  highlights: [
    "Har Ki Pauri",
    "Ganga Aarti",
    "Local chaat market"
  ],
  map: "https://www.google.com/maps?q=Delhi+to+Haridwar&output=embed",
  hotel: {
    name: "Hotel Ganga Lahari / similar (Har Ki Pauri area)",
    map: "https://maps.google.com/?q=Hotel+Ganga+Lahari+Haridwar"
  }
},
{
  city: "Haridwar ‚Üí Rishikesh",
  title: "Snaan & Ropeways",
  steps: [
    "Early morning Ganga Snaan",
    "Mansa Devi Ropeway",
    "Chandi Devi Ropeway",
    "Lunch",
    "Cab to Rishikesh",
    "Evening local market walk"
  ],
  highlights: [
    "Mansa Devi",
    "Chandi Devi"
  ],
  map: "https://www.google.com/maps?q=Haridwar+to+Rishikesh&output=embed",
  hotel: {
    name: "Tapovan Sarovar / similar (Tapovan)",
    map: "https://maps.google.com/?q=Tapovan+Rishikesh+Hotel"
  }
},
{
  city: "Rishikesh",
  title: "Tapovan & Caf√©s",
  steps: [
    "Ram Jhula",
    "Laxman Jhula",
    "Saptarishi Ashram",
    "Caf√© hopping in Tapovan",
    "Sunset at riverbank"
  ],
  highlights: [
    "Ram Jhula",
    "Laxman Jhula",
    "Saptarishi Ashram"
  ],
  map: "https://www.google.com/maps?q=Tapovan+Rishikesh&output=embed",
  hotel: {
    name: "Tapovan Stay (same hotel)",
    map: "https://maps.google.com/?q=Tapovan+Rishikesh"
  }
},
{
  city: "Rishikesh",
  title: "Rafting & Recovery",
  steps: [
    "Morning river rafting",
    "Return to hotel & freshen up",
    "Triveni Ghat",
    "Ganga Aarti",
    "Dinner by riverside caf√©"
  ],
  highlights: [
    "River Rafting",
    "Triveni Ghat"
  ],
  map: "https://www.google.com/maps?q=Rishikesh+River+Rafting&output=embed",
  hotel: {
    name: "Tapovan Stay (same hotel)",
    map: "https://maps.google.com/?q=Tapovan+Rishikesh"
  }
},
{
  city: "Rishikesh ‚Üí Dehradun",
  title: "Ashrams & Waterfall",
  steps: [
    "Checkout from Rishikesh",
    "Neer Garh Waterfall",
    "Cab to Dehradun",
    "Drona Ashram",
    "Deer Park",
    "Evening market walk"
  ],
  highlights: [
    "Neer Garh Waterfall",
    "Drona Ashram",
    "Deer Park"
  ],
  map: "https://www.google.com/maps?q=Rishikesh+to+Dehradun&output=embed",
  hotel: {
    name: "Hotel near Rajpur Road / Ballupur",
    map: "https://maps.google.com/?q=Rajpur+Road+Dehradun+Hotel"
  }
},
{
  city: "Mussoorie ‚Üí Delhi",
  title: "Hill Wrap-up",
  steps: [
    "Early drive to Mussoorie",
    "Sahastradhara Waterfall",
    "Mall Road walk",
    "Return to Dehradun",
    "Overnight bus / flight to Delhi"
  ],
  highlights: [
    "Sahastradhara",
    "Mussoorie Mall Road"
  ],
  map: "https://www.google.com/maps?q=Dehradun+to+Mussoorie&output=embed",
  hotel: {
    name: "Day trip ‚Äì no stay",
    map: "https://maps.google.com/?q=Mussoorie+Mall+Road"
  }
}
];


let participants=["Sahil","Patil"];
let expenses={};
let notes={};
let active=0;

/* INIT / SYNC */
onSnapshot(tripRef,(snap)=>{
 if(!snap.exists() || !snap.data().participants){
  saveTrip(true);
  return;
 }
 const d=snap.data();
 participants=d.participants;
 expenses=d.expenses||{};
 notes=d.notes||{};
 render();
});

/* SAVE */
function saveTrip(seed=false){
 setDoc(tripRef,{
  participants,
  expenses,
  notes,
  updatedAt:Date.now()
 },{merge:!seed});
}

/* UI */
const timeline=document.getElementById("timeline");
const content=document.getElementById("content");

function buildTimeline(){
 timeline.innerHTML="";
 days.forEach((d,i)=>{
  const c=document.createElement("div");
  c.className="card"+(i===active?" active":"");
  c.innerHTML=`<b>${tripDates[i]}</b><br>${d.city}`;
  c.onclick=()=>select(i);
  timeline.appendChild(c);
 });
}

function render(){
 buildTimeline();
 renderMembers();
 document.getElementById("progressText").innerText=`${tripDates[active]} ‚Äî ${days[active].city}`;
 document.querySelectorAll(".node").forEach((n,i)=>n.classList.toggle("active",i<=active));
 document.getElementById("vehicle").style.left=`calc(${active*(100/(days.length-1))}% - 12px)`;

 const d=days[active];
 const dayExp=expenses[active]||[];

 content.innerHTML = `
<div class="sectionCard">
  <div class="sectionHeader">üß≠ Step-by-step</div>
  <div class="sectionBody">
    <ul>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ul>
  </div>
</div>

<div class="sectionCard">
  <div class="sectionHeader">üó∫ Route Map</div>
  <div class="sectionBody">
    <iframe src="${d.map}"></iframe>
  </div>
</div>

<div class="sectionCard">
  <div class="sectionHeader">üè® Hotel</div>
  <div class="sectionBody">
    <a href="${d.hotel.map}" target="_blank">${d.hotel.name}</a>
    <iframe src="${d.hotel.map}&output=embed"></iframe>
  </div>
</div>

<div class="sectionCard">
  <div class="sectionHeader">üìù Notes</div>
  <div class="sectionBody">
    <textarea ${viewOnly?"disabled":""} oninput="saveNote(this.value)">${notes[active]||""}</textarea>
  </div>
</div>

<div class="sectionCard">
  <div class="sectionHeader">üí≥ Add Expense</div>
  <div class="sectionBody">
    <input id="et" placeholder="Title" ${viewOnly?"disabled":""}>
    <input id="ea" type="number" placeholder="Amount" ${viewOnly?"disabled":""}>
    <select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
    <button onclick="addExpense()" ${viewOnly?"disabled":""}>Add</button>
  </div>
</div>

<div class="sectionCard">
  <div class="sectionHeader">üßæ Expenses</div>
  <div class="sectionBody">
    ${(expenses[active]||[]).map((e,i)=>`
      <div>
        ${e.title} ‚Çπ${e.amount} (${e.paidBy})
        ${viewOnly?"":`<button onclick="del(${i})">‚ùå</button>`}
      </div>`).join("") || "No expenses"}
  </div>
</div>
`;

}

/* ACTIONS */
window.addExpense=()=>{
 if(viewOnly)return;
 const t=et.value,a=+ea.value,p=ep.value;
 if(!t||!a)return;
 expenses[active]=expenses[active]||[];
 expenses[active].push({title:t,amount:a,paidBy:p});
 saveTrip();
};

window.del=(i)=>{
 if(viewOnly)return;
 expenses[active].splice(i,1);
 saveTrip();
};

window.saveNote=(v)=>{
 if(viewOnly)return;
 notes[active]=v;
 saveTrip();
};

window.addMember=()=>{
 if(viewOnly)return;
 const v=newMember.value.trim();
 if(!v)return;
 participants.push(v);
 newMember.value="";
 saveTrip();
};

window.removeMember=(i)=>{
 if(viewOnly)return;
 participants.splice(i,1);
 saveTrip();
};

function renderMembers(){
 const ul=document.getElementById("memberList");
 ul.innerHTML="";
 participants.forEach((p,i)=>{
  ul.innerHTML+=`<li>${p} ${viewOnly?"":"<button onclick='removeMember("+i+")'>‚ùå</button>"}</li>`;
 });
}

/* NAV */
window.select=(i)=>{active=i;render();}
window.next=()=>{active=(active+1)%days.length;render();}
window.prev=()=>{active=(active-1+days.length)%days.length;render();}

/* TRIP OPEN */
window.openTrip=()=>{
 const t=document.getElementById("tripInput").value.trim();
 if(!t)return;
 location.href=`?trip=${t}`;
};
</script>
</body>
</html>
