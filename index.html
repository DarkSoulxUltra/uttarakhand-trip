<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Uttarakhand Trip Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#020b1f;
  --border:#164e63;
  --accent:#22d3ee;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto;
  background:var(--bg);
  color:#a5f3fc;
}
h1{text-align:center;color:var(--accent)}
.container{max-width:1400px;margin:auto;padding:16px}

/* ROUTE */
.route{
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
  margin-bottom:20px;
  position:relative;
}
.route-title{text-align:center;color:var(--accent);margin-bottom:10px}
.route-line{
  display:flex;justify-content:space-between;align-items:center;
  position:relative;margin-top:10px
}
.route-line::before{
  content:"";position:absolute;left:0;right:0;top:50%;
  height:3px;background:var(--border)
}
.dot{
  width:16px;height:16px;border-radius:50%;
  background:#155e75;z-index:1;cursor:pointer
}
.dot.active{background:var(--accent);box-shadow:0 0 10px var(--accent)}
.bus{
  position:absolute;top:-28px;transition:.4s;font-size:18px
}

/* TOGGLE */
.toggle{
  position:absolute;right:20px;top:20px;display:flex;align-items:center;gap:10px
}
.switch{
  width:52px;height:28px;border-radius:999px;background:#1e293b;
  position:relative;cursor:pointer
}
.switch::after{
  content:"";width:22px;height:22px;border-radius:50%;
  background:white;position:absolute;top:3px;left:4px;transition:.3s
}
.switch.on{background:#22c55e}
.switch.on::after{left:26px}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
}
.card h3{
  margin:0 0 8px 0;
  color:var(--accent);
  cursor:pointer;
}
.card.collapsed .body{display:none}
iframe{width:100%;height:220px;border:0;border-radius:10px}

/* FORM */
input,select,textarea,button{
  width:100%;margin:6px 0;padding:8px;
  border-radius:6px;border:none
}
button{background:var(--accent);cursor:pointer}
.log{font-size:13px;border-bottom:1px solid #134e4a;padding:4px 0}
</style>
</head>

<body>
<div class="container">
<h1>Uttarakhand Trip Planner</h1>

<!-- ROUTE -->
<div class="route">
  <div class="route-title" id="routeTitle"></div>

  <div class="toggle">
    <span>Collapse</span>
    <div id="expandToggle" class="switch"></div>
    <span>Expand</span>
  </div>

  <div class="route-line" id="routeLine">
    <div class="bus" id="bus">üöå</div>
  </div>
</div>

<!-- CARDS -->
<div class="grid" id="cards"></div>
</div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= DATA ================= */
const tripId = new URLSearchParams(location.search).get("trip") || "default";

const tripDates = ["Sun","Mon","Tue","Wed","Thu","Fri"];

const days = [
  {
    city:"Delhi ‚Üí Haridwar",
    steps:["Arrive Delhi","Bus to Haridwar","Hotel check-in","Ganga Aarti"],
    routeMap:"https://www.google.com/maps?q=Delhi+to+Haridwar&output=embed",
    hotel:{
      name:"Hotel Ganga Lahari / similar (Har Ki Pauri area)",
      link:"https://maps.google.com/?q=Hotel+Ganga+Lahari+Haridwar",
      map:"https://www.google.com/maps?q=Hotel+Ganga+Lahari+Haridwar"
    },
    food:["Local chai","Chotiwala"],
    emergency:["Ambulance:108","Police:112","District Hospital Haridwar"]
  },
  {
    city:"Haridwar ‚Üí Rishikesh",
    steps:["Morning Aarti","Travel to Rishikesh","Explore ghats"],
    routeMap:"https://www.google.com/maps?q=Haridwar+to+Rishikesh&output=embed",
    hotel:{
      name:"Aloha on the Ganges",
      link:"https://maps.google.com/?q=Aloha+on+the+Ganges",
      map:"https://www.google.com/maps?q=Aloha+on+the+Ganges"
    },
    food:["German Bakery","Ganga View Cafe"],
    emergency:["Ambulance:108","Police:112","AIIMS Rishikesh"]
  },
  {city:"Rishikesh",steps:["Rafting","Cafes","Ashrams"],routeMap:"https://www.google.com/maps?q=Rishikesh+River+Rafting&output=embed",hotel:{name:"Same Hotel (Aloha on the Ganges)",link:"#",map:"https://www.google.com/maps?q=Aloha+on+the+Ganges"},food:["Cafe","Tea"],emergency:["108","112"]},
  {city:"Rishikesh",steps:["Waterfall","Rest"],routeMap:"https://www.google.com/maps?q=Rishikesh+Neer+Waterfall&output=embed",hotel:{name:"Same Hotel (Aloha on the Ganges)",link:"#",map:"https://www.google.com/maps?q=Aloha+on+the+Ganges"},food:["Snacks"],emergency:["108"]},
  {city:"Rishikesh ‚Üí Dehradun",steps:["Travel","Explore"],routeMap:"https://www.google.com/maps?q=Rishikesh+to+Dehradun&output=embed",hotel:{name:"Hotel near Rajpur Road / Ballupur",link:"#",map:"https://www.google.com/maps?q=Rajpur+Road+Dehradun+Hotel"},food:["Street food"],emergency:["108"]},
  {city:"Mussoorie ‚Üí Delhi",steps:["Sightseeing","Return"],routeMap:"https://www.google.com/maps?q=Dehradun+to+Mussoorie&output=embed",hotel:{name:"Day Trip - No Stay",link:"#",map:"https://www.google.com/maps?q=Mussoorie+Mall+Road"},food:["Cafe"],emergency:["108"]}
];

  
let activeDay = 0;
let cardsExpanded = false;
let expenses = [];
let logs = [];
const participants = ["Sahil","Patil"];
function getOpenCards() {
  return Array.from(document.querySelectorAll(".card:not(.collapsed)"))
    .map(card => card.dataset.card);
}

function restoreOpenCards(openCards) {
  document.querySelectorAll(".card").forEach(card => {
    if (openCards.includes(card.dataset.card)) {
      card.classList.remove("collapsed");
    }
  });
}

/* ================= ROUTE ================= */
const routeLine = document.getElementById("routeLine");
days.forEach((_,i)=>{
  const d=document.createElement("div");
  d.className="dot";
  d.onclick=()=>{activeDay=i;render()};
  routeLine.appendChild(d);
});

/* ================= FIREBASE SYNC ================= */
db.collection("trips").doc(tripId).collection("expenses")
.onSnapshot(s=>{
  expenses=s.docs.map(d=>({...d.data(),id:d.id}));
  render(false);
});

db.collection("trips").doc(tripId).collection("logs")
.orderBy("time")
.onSnapshot(s=>{
  logs=s.docs.map(d=>d.data());
  render(false);
});

/* ================= SETTLEMENT ================= */
function calculateSettlement(){
  let total=0, paid={};
  participants.forEach(p=>paid[p]=0);
  expenses.forEach(e=>{
    total+=e.amount;
    paid[e.paidBy]+=e.amount;
  });
  const share=participants.length?total/participants.length:0;
  let settlement={};
  participants.forEach(p=>settlement[p]=Math.round(paid[p]-share));
  return {total,share,settlement};
}

/* ================= RENDER ================= */
function card(title, key, body) {
  return `
    <div class="card collapsed" data-card="${key}">
      <div class="cardHeader" onclick="toggleCard(this)">
        ${title}
      </div>
      <div class="cardBody">
        ${body}
      </div>
    </div>
  `;
}


function toggleCard(h){
  h.parentElement.classList.toggle("collapsed");
}

function render(moveBus=true){
  const openCards = cardsExpanded ? [] : getOpenCards();
  const d=days[activeDay];
  document.getElementById("routeTitle").innerText=
    `${tripDates[activeDay]} ‚Äî ${d.city}`;

  document.querySelectorAll(".dot").forEach((dot,i)=>{
    dot.classList.toggle("active",i===activeDay);
  });

  if(moveBus){
    const bus=document.getElementById("bus");
    bus.style.left=`calc(${activeDay*(100/(days.length-1))}% - 8px)`;
  }

  const {total,share,settlement}=calculateSettlement();

  document.getElementById("cards").innerHTML = `
${card("üß≠ Step-by-step","step-by-step", `<ul>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ul>`)}
${card("üó∫ Route Map", "routemap",`<iframe src="${d.routeMap}"></iframe>`)}
${card("üè® Hotel", "hotel", `<a href="${d.hotel.link}" target="_blank">${d.hotel.name}</a><iframe src="${d.hotel.map}"></iframe>`)}
${card("üìù Notes", "notes",`<textarea placeholder="Notes for the day"></textarea>`)}
${card("üçΩ Food & Snacks", "food&snacks",`<ul>${d.food.map(f=>`<li>${f}</li>`).join("")}</ul>`)}
${card("üöë Emergency", "emergency", `<ul>${d.emergency.map(e=>`<li>${e}</li>`).join("")}</ul>`)}
${card("üí≥ Expenses", "expenses",`
<input id="et" placeholder="Title">
<input id="ea" type="number" placeholder="Amount">
<select id="ep">${participants.map(p=>`<option>${p}</option>`).join("")}</select>
<button onclick="addExpense()">Add</button>
${expenses.map(e=>`<div>${e.title} ‚Çπ${e.amount} (${e.paidBy}) <button onclick="delExpense('${e.id}')">‚ùå</button></div>`).join("")}
`)}
${card("üìä Settlement", "settlement",`
<b>Total:</b> ‚Çπ${total}<br>
<b>Per Person:</b> ‚Çπ${Math.round(share)}<hr>
${Object.entries(settlement).map(([p,v])=>v>0?`üü¢ ${p} gets ‚Çπ${v}`:v<0?`üî¥ ${p} pays ‚Çπ${Math.abs(v)}`:`‚ö™ ${p} settled`).join("<br>")}
`)}
${card("üßæ Logs", logs.map(l=>`<div class="log">${l.text}</div>`).join("") )}
`;

  if (!cardsExpanded) {
  restoreOpenCards(openCards);
}

}

/* ================= ACTIONS ================= */
function addExpense(){
  const title=et.value;
  const amount=Number(ea.value);
  const paidBy=ep.value;
  if(!title||!amount)return;

  db.collection("trips").doc(tripId).collection("expenses").add({
    title,amount,paidBy
  });

  db.collection("trips").doc(tripId).collection("logs").add({
    text:`${paidBy} added ‚Çπ${amount} for ${title}`,
    time:Date.now()
  });
}

function delExpense(id){
  const exp=expenses.find(e=>e.id===id);
  db.collection("trips").doc(tripId).collection("expenses").doc(id).delete();
  db.collection("trips").doc(tripId).collection("logs").add({
    text:`${exp.paidBy} removed ‚Çπ${exp.amount} for ${exp.title}`,
    time:Date.now()
  });
}

/* ================= TOGGLE ================= */
document.getElementById("expandToggle").onclick=()=>{
  cardsExpanded=!cardsExpanded;
  document.getElementById("expandToggle").classList.toggle("on",cardsExpanded);
  render(false);
};

render();
</script>
</body>
</html>
