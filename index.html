<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uttarakhand Trip Planner</title>

<style>
body{margin:0;font-family:system-ui;background:#020617;color:#67e8f9}
h1{text-align:center;margin:12px 0}
.container{max-width:1400px;margin:auto;padding:12px;padding-bottom:200px}

/* ROUTE */
.stickyTop{position:sticky;top:0;background:#020617;z-index:5}
.routeBox{position:relative;border:1px solid #164e63;border-radius:16px;padding:12px;margin-bottom:12px}
.progressText{text-align:center;color:#22d3ee;font-weight:600;margin-bottom:8px}

.routeActions{
 position:absolute;
 top:10px;
 right:12px;
 display:flex;
 gap:8px;
}
.routeActions button{
 padding:4px 8px;
 font-size:12px;
}

.routeLine{position:relative;display:flex;justify-content:space-between;align-items:center;height:36px}
.routeLine::before{content:'';position:absolute;left:0;right:0;top:50%;height:3px;background:#164e63}
.routeFill{position:absolute;left:0;top:50%;height:3px;background:#22d3ee;width:0%;transition:width .4s ease}
.node{width:18px;height:18px;background:#164e63;border-radius:50%;cursor:pointer;z-index:1}
.node.active{background:#22d3ee;box-shadow:0 0 10px #22d3ee}
.vehicle{position:absolute;top:-24px;transition:.25s}

/* LAYOUT */
.layout{display:grid;grid-template-columns:260px 1fr;gap:14px}
@media(max-width:900px){.layout{grid-template-columns:1fr}}
.timeline{border:1px solid #164e63;border-radius:14px;padding:10px}
.card{border:1px solid #164e63;border-radius:12px;padding:10px;margin-bottom:8px;cursor:pointer}
.card.active{border-color:#22d3ee;box-shadow:0 0 12px rgba(34,211,238,.4)}
.content{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}

/* SECTION CARDS */
.sectionCard{border:1px solid #164e63;border-radius:14px;padding:12px;background:rgba(2,6,23,.6)}
.sectionHeader{font-weight:700;color:#22d3ee;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.sectionBody{max-height:900px;overflow:hidden;transition:max-height .35s ease,opacity .25s ease}
.sectionCard.collapsed .sectionBody{max-height:0;opacity:0;margin-top:0}
.sectionHeader::after{content:"‚ñæ";transition:transform .3s}
.sectionCard.collapsed .sectionHeader::after{transform:rotate(-90deg)}

input,textarea,select{width:100%;padding:6px;border-radius:6px;border:none;margin:4px 0}
button{background:#22d3ee;border:none;border-radius:6px;padding:6px 10px;font-weight:600;cursor:pointer}
button[disabled]{opacity:.4;cursor:not-allowed}
iframe{width:100%;height:220px;border-radius:10px;border:1px solid #164e63}
</style>
</head>

<body>
<div class="container" id="appRoot">
<h1>Uttarakhand Trip Planner</h1>

<details>
<summary>‚ûï Open / Create Trip</summary>
<input id="tripInput" placeholder="e.g. uttarakhand-mar-2026">
<button onclick="openTrip()">Open Trip</button>
</details>

<details>
<summary>üë• Participants <span id="viewBadge"></span></summary>
<input id="newMember" placeholder="Name">
<button onclick="addMember()">Add</button>
<ul id="memberList"></ul>
</details>

<div class="stickyTop">
<div class="routeBox">
<div class="progressText" id="progressText"></div>

<div class="routeActions">
<button onclick="expandAll()">Expand all</button>
<button onclick="collapseAll()">Collapse all</button>
</div>

<div class="routeLine">
<div class="routeFill" id="routeFill"></div>
<div id="vehicle" class="vehicle">üöå</div>
<div class="node" onclick="select(0)"></div>
<div class="node" onclick="select(1)"></div>
<div class="node" onclick="select(2)"></div>
<div class="node" onclick="select(3)"></div>
<div class="node" onclick="select(4)"></div>
<div class="node" onclick="select(5)"></div>
</div>
</div>
</div>

<div class="layout">
<div class="timeline" id="timeline"></div>
<div class="content" id="content"></div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• Firebase */
const firebaseConfig={
 apiKey:"AIzaSyBqiBMggvuMxAiKfBpJIqnv8OCWj76voAk",
 authDomain:"trip-planner-2026.firebaseapp.com",
 projectId:"trip-planner-2026",
 storageBucket:"trip-planner-2026.firebasestorage.app",
 messagingSenderId:"118349993233",
 appId:"1:118349993233:web:7edb1de869796188a428b0"
};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* üîó URL */
const params=new URLSearchParams(location.search);
const tripId=params.get("trip")||"uttarakhand-mar-2026";
const viewOnly=params.get("view")==="readonly";
document.getElementById("viewBadge").innerText=viewOnly?"(View only)":"";

/* üîÅ Global UI state */
let globalExpandState="collapsed";

/* üóì Days (FULL, SAFE) */
const tripDates=["Sun","Mon","Tue","Wed","Thu","Fri"];
const days=[
{
 city:"Delhi ‚Üí Haridwar",
 title:"Arrival & Ganga Aarti",
 steps:["Arrive Delhi","Bus to Haridwar","Hotel check-in","Ganga Aarti","Market walk"],
 map:"https://www.google.com/maps?q=Delhi+to+Haridwar&output=embed",
 hotel:{name:"Hotel Ganga Lahari",map:"https://maps.google.com/?q=Hotel+Ganga+Lahari+Haridwar"},
 emergency:{ambulance:"108",police:"112",hospital:"District Hospital Haridwar"},
 food:{breakfast:["Local chai stall"],cafes:["Chotiwala"]}
},
{
 city:"Haridwar ‚Üí Rishikesh",
 title:"Ropeways & Transfer",
 steps:["Ganga Snaan","Mansa Devi","Chandi Devi","Cab to Rishikesh"],
 map:"https://www.google.com/maps?q=Haridwar+to+Rishikesh&output=embed",
 hotel:{name:"Tapovan Stay",map:"https://maps.google.com/?q=Tapovan+Rishikesh"},
 emergency:{ambulance:"108",police:"112",hospital:"AIIMS Rishikesh"},
 food:{breakfast:["Chotiwala"],cafes:["Little Buddha Caf√©"]}
},
{
 city:"Rishikesh",
 title:"Tapovan & Caf√©s",
 steps:["Ram Jhula","Laxman Jhula","Saptarishi Ashram","Caf√© hopping"],
 map:"https://www.google.com/maps?q=Tapovan+Rishikesh&output=embed",
 hotel:{name:"Tapovan Stay",map:"https://maps.google.com/?q=Tapovan+Rishikesh"},
 emergency:{ambulance:"108",police:"112",hospital:"AIIMS Rishikesh"},
 food:{breakfast:["Local tea"],cafes:["Freedom Caf√©","Ganga View Caf√©"]}
},
{
 city:"Rishikesh",
 title:"Rafting & Ghat",
 steps:["River rafting","Freshen up","Triveni Ghat","Dinner"],
 map:"https://www.google.com/maps?q=Rishikesh+Rafting&output=embed",
 hotel:{name:"Tapovan Stay",map:"https://maps.google.com/?q=Tapovan+Rishikesh"},
 emergency:{ambulance:"108",police:"112",hospital:"AIIMS Rishikesh"},
 food:{breakfast:["Early chai"],cafes:["Little Buddha Caf√©"]}
},
{
 city:"Rishikesh ‚Üí Dehradun",
 title:"Ashrams & Waterfall",
 steps:["Neer Garh","Drona Ashram","Deer Park","Market walk"],
 map:"https://www.google.com/maps?q=Rishikesh+to+Dehradun&output=embed",
 hotel:{name:"Rajpur Road Hotel",map:"https://maps.google.com/?q=Rajpur+Road+Dehradun"},
 emergency:{ambulance:"108",police:"112",hospital:"Doon Hospital"},
 food:{breakfast:["Hotel breakfast"],cafes:["Orchard Caf√©"]}
},
{
 city:"Mussoorie ‚Üí Delhi",
 title:"Hill Wrap-up",
 steps:["Sahastradhara","Mall Road","Return to Delhi"],
 map:"https://www.google.com/maps?q=Dehradun+to+Mussoorie&output=embed",
 hotel:{name:"Day Trip",map:"https://maps.google.com/?q=Mussoorie"},
 emergency:{ambulance:"108",police:"112",hospital:"Landour Hospital"},
 food:{breakfast:["Local caf√©"],cafes:["Cafe Ivy"]}
}
];

/* üß† State */
let active=0;
let participants=["Sahil","Patil"];
let notes={};
const tripRef=doc(db,"trips",tripId);

/* üîÑ Firestore sync */
onSnapshot(tripRef,(snap)=>{
 if(!snap.exists()){saveTrip(true);return;}
 const d=snap.data();
 participants=d.participants||participants;
 notes=d.notes||{};
 render();
});
function saveTrip(seed=false){
 setDoc(tripRef,{participants,notes,updatedAt:Date.now()},{merge:!seed});
}

/* üß© Rendering */
const timeline=document.getElementById("timeline");
const content=document.getElementById("content");

function buildTimeline(){
 timeline.innerHTML="";
 days.forEach((d,i)=>{
  const c=document.createElement("div");
  c.className="card"+(i===active?" active":"");
  c.innerHTML=`<b>${tripDates[i]}</b><br>${d.city}`;
  c.onclick=()=>select(i);
  timeline.appendChild(c);
 });
}

function section(title,body,autoOpen=false){
 const collapsed = autoOpen
   ? false
   : globalExpandState==="collapsed";
 return `
 <div class="sectionCard ${collapsed?"collapsed":""}">
  <div class="sectionHeader" onclick="toggleCard(this)">${title}</div>
  <div class="sectionBody">${body}</div>
 </div>`;
}

function render(){
 buildTimeline();
 renderMembers();

 document.getElementById("progressText").innerText=
 `${tripDates[active]} ‚Äî ${days[active].city}`;

 document.querySelectorAll(".node")
   .forEach((n,i)=>n.classList.toggle("active",i<=active));

 document.getElementById("vehicle").style.left=
 `calc(${active*(100/(days.length-1))}% - 12px)`;

 document.getElementById("routeFill").style.width=
 (active/(days.length-1))*100+"%";

 const d=days[active];

 content.innerHTML=
 section("üß≠ Step-by-step",
   `<ul>${d.steps.map(s=>`<li>${s}</li>`).join("")}</ul>`,true)
 + section("üó∫ Route Map",`<iframe src="${d.map}"></iframe>`)
 + section("üè® Hotel",
   `<a href="${d.hotel.map}" target="_blank">${d.hotel.name}</a>
    <iframe src="${d.hotel.map}&output=embed"></iframe>`)
 + section("üìù Notes",
   `<textarea ${viewOnly?"disabled":""}
    oninput="saveNote(this.value)">${notes[active]||""}</textarea>`,true)
 + section("üö® Emergency",
   `<ul>
     <li><b>Ambulance:</b> ${d.emergency.ambulance}</li>
     <li><b>Police:</b> ${d.emergency.police}</li>
     <li><b>Hospital:</b> ${d.emergency.hospital}</li>
    </ul>`)
 + section("‚òï Food & Snacks Nearby",
   `<b>Breakfast</b>
    <ul>${d.food.breakfast.map(f=>`<li>${f}</li>`).join("")}</ul>
    <b>Caf√©s</b>
    <ul>${d.food.cafes.map(f=>`<li>${f}</li>`).join("")}</ul>`);
}

/* üîò Card controls */
window.toggleCard=(el)=>{
 el.parentElement.classList.toggle("collapsed");
};
window.expandAll=()=>{
 globalExpandState="expanded";
 document.querySelectorAll(".sectionCard")
   .forEach(c=>c.classList.remove("collapsed"));
};
window.collapseAll=()=>{
 globalExpandState="collapsed";
 document.querySelectorAll(".sectionCard")
   .forEach(c=>c.classList.add("collapsed"));
};

/* üß≠ Navigation */
window.select=(i)=>{active=i;render();};

/* üë• Participants */
window.addMember=()=>{
 if(viewOnly)return;
 const v=newMember.value.trim();
 if(!v)return;
 participants.push(v);
 newMember.value="";
 saveTrip();
};
window.removeMember=(i)=>{
 if(viewOnly)return;
 participants.splice(i,1);
 saveTrip();
};
function renderMembers(){
 memberList.innerHTML="";
 participants.forEach((p,i)=>{
  memberList.innerHTML+=`<li>${p}
   ${viewOnly?"":`<button onclick="removeMember(${i})">‚ùå</button>`}
  </li>`;
 });
}
window.saveNote=(v)=>{if(viewOnly)return;notes[active]=v;saveTrip();}
window.openTrip=()=>{
 const t=tripInput.value.trim();
 if(t)location.href=`?trip=${t}`;
};

/* üñêÔ∏è Swipe navigation (safe) */
let touchStartX=0;
const root=document.getElementById("appRoot");

root.addEventListener("touchstart",e=>{
 if(e.target.closest("input,textarea,select"))return;
 touchStartX=e.touches[0].clientX;
},{passive:true});

root.addEventListener("touchend",e=>{
 const dx=e.changedTouches[0].clientX-touchStartX;
 if(Math.abs(dx)<60)return;
 if(dx<0 && active<days.length-1)select(active+1);
 if(dx>0 && active>0)select(active-1);
},{passive:true});
</script>
</body>
</html>
